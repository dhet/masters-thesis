
\subsection{Container Networking with \wnet}

\wnet\ is an open source project\footnote{\url{www.github.com/weaveworks/weave}} which aims to provide advanced overlay networking capabilities for \docker\ containers. It is designed to make up for the shortcomings of \docker 's built-in overlay networks, and more specifically, their lack of encryption and multicast support. By means of \docker\ overlay networks, containers dispersed among physical hosts that reside in their own physical networks, may exchange data freely. \wnet\ presents the network to the applications in a location transparent way, such that from the applications' viewpoint, it does not matter whether its peers are located on the same host or within a data center on the other side of the world. \wnet\ is developed by a global team, mostly employed by the London-based software company \emph{Weaveworks}\footnote{\url{www.weave.works}}.


\paragraph{Workings.}
\wnet\ is implemented as client software which is installed on each machine that hosts \docker\ containers. The software can be started using a single command, and in the following, all containers booted will automatically connected to the overlay network. This is achieved by means of a \emph{\docker\ API proxy}. The proxy sits between \docker 's command-line client and the \docker\ daemon and intercepts all communication between the two. When the \docker\ engine is instructed to start a container, the proxy takes all precautions needed to enable overlay networking for that container.


\begin{figure}[htpb]
  \centering
  \includegraphics[width=\textwidth]{figures/sdn.pdf}
  \caption[An example of containers connected via \wnet\ overlay network]{A number of dispersed containers connected by a \wnet\ overlay network}\label{fig:weavescheme} \todo[inline]{Add legend for boxes, add another host}
\end{figure}

When the Weave software is started, a central component of \wnet , the \emph{Weave router} is launched (\cf\ \autoref{fig:weavescheme}). Similar to a hardware router, the Weave router is responsible for the forwarding and routing of data packets to their appropriate receivers. Weave routers can be seen as gateways through which all containers participating in a Weave network are connected. To facilitate routing on the data plane, a custom UDP encapsulation protocol, called \emph{sleeve}, was devised. A Weave router in itself is an containerized application running at all times, in the same way a daemon would. There is one of such router containers running on every host in a Weave-enabled infrastructure.

The Weave router is a user space process. As such, a context switch is needed every time it is tasked to process a packet. This comes with a substantial performance overhead. Hence, as a faster alternative, the so-called \emph{fast datapath} mode was added. In this mode, packets are processed by the Linux kernel instead of by the Weave router. This way, the context switch into user space is omitted. \wnet\ leverages the Linux kernel's \emph{Open vSwitch datapath} module \cite{pfaff2015design} to achieve this behavior. Open vSwitch can be used to create a software-based, virtual network switch. That way, the kernel can be instructed to process packets in a certain way. For instance, the kernel can be commanded to add a VXLAN header to each packet, thereby achieving the same result as the Weave router, but faster. However, fast datapath mode can only be used when the underlying infrastructure allows it, and particularly, when MTU allows it.


\paragraph{Topology Management.} 
Weave's topology management is self-governing in that peers continually exchange topology information, and monitor and (re)establish network connections to other peers in the network. All participating peers know the topology of the entire network. For this, \wnet\ employs a sophisticated discovery and topology management mechanism by which changes in the network topology are rapidly propagated within the network. The topology management protocol is based on a spanning-tree broadcast mechanism known from hardware switches. To further ensure that all peers have an up-to-date neighbor list at all times, \wnet\ additionally employs a custom neighbor gossiping protocol by which each peer sends update messages to a random subset of their neighbors. Updates of the network's topology are performed periodically as well as when certain events occur, such as when a node joins or leaves the network.


\paragraph{Encryption.} 
As mentioned earlier, a salient feature of \wnet\ is the ability to encrypt all traffic within the network. This is especially important for networks that span over WANs, such as the Internet, which are inherently insecure. The way encryption is applied differs depending on the forwarding mode used (sleeve and fast datapath).

In fast datapath mode, an IPsec-based encryption mechanism is used. Each packet is encapsulated in the ESP. Encryption is built using the Linux Crypto API

Password based encryption


For sleeve mode:
Curve25519, XSalsa20 and Poly1305
Similar to TLS, but unlike TLS, Weave encryption supports UDP.


All traffic flows through three ports: one of type TCP and two of type UDP.


Drawbacks: \wnet\ does not support IPv6 which is to the detriment of IoT networks, which benefit from the vast number of addresses of IPv6. However, in the vehicle use case, it is rather unlikely that every ECU has its own IP address. Rather, there is one gateway connected to a 5G module and all traffic is routed through that gateway. Because of this, the address scarcity issue only peripherally applies to the intended use case.